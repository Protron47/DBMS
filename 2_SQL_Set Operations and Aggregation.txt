SQL Queries
Account(Acc_no, branch_name,balance)
branch(branch_name,branch_city,assets)
customer(cust_name,cust_street,cust_city)
Depositor(cust_name,acc_no)
Loan(loan_no,branch_name,amount)
Borrower(cust_name,loan_no)

Solve following query:
a) Find all customers who have an account or loan or both at bank.
b) Find all customers who have both account and loan at bank.
c) Find all customers who have account but no loan at the bank.
d) Find average account balance at Akurdi branch.


-------------------


-- branch table
CREATE TABLE branch (
    branch_name VARCHAR(50) PRIMARY KEY,
    branch_city VARCHAR(50) NOT NULL,
    assets NUMERIC(15, 2) CHECK (assets >= 0)
);

-- customer table
CREATE TABLE customer (
    cust_name VARCHAR(50) PRIMARY KEY,
    cust_street VARCHAR(50),
    cust_city VARCHAR(50)
);

-- Account table
CREATE TABLE Account (
    Acc_no VARCHAR(10) PRIMARY KEY,
    branch_name VARCHAR(50) NOT NULL,
    balance NUMERIC(10, 2) CHECK (balance >= 0),
    FOREIGN KEY (branch_name) REFERENCES branch(branch_name)
);

-- Loan table
CREATE TABLE Loan (
    loan_no VARCHAR(10) PRIMARY KEY,
    branch_name VARCHAR(50) NOT NULL,
    amount NUMERIC(10, 2) CHECK (amount > 0),
    FOREIGN KEY (branch_name) REFERENCES branch(branch_name)
);

-- Depositor table (Many-to-Many between Customer and Account)
CREATE TABLE Depositor (
    cust_name VARCHAR(50),
    acc_no VARCHAR(10),
    PRIMARY KEY (cust_name, acc_no),
    FOREIGN KEY (cust_name) REFERENCES customer(cust_name),
    FOREIGN KEY (acc_no) REFERENCES Account(Acc_no)
);

-- Borrower table (Many-to-Many between Customer and Loan)
CREATE TABLE Borrower (
    cust_name VARCHAR(50),
    loan_no VARCHAR(10),
    PRIMARY KEY (cust_name, loan_no),
    FOREIGN KEY (cust_name) REFERENCES customer(cust_name),
    FOREIGN KEY (loan_no) REFERENCES Loan(loan_no)
);





SELECT cust_name FROM Depositor
UNION
SELECT cust_name FROM Borrower;



SELECT cust_name FROM Depositor
INTERSECT
SELECT cust_name FROM Borrower;




SELECT cust_name FROM Depositor
EXCEPT
SELECT cust_name FROM Borrower;
-- OR using a subquery (NOT IN)
SELECT cust_name
FROM Depositor
WHERE cust_name NOT IN (SELECT cust_name FROM Borrower);



SELECT AVG(balance) AS average_balance
FROM Account
WHERE branch_name = 'Akurdi';


