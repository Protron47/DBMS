7
SQL queries

Create following tables with suitable constraints. 
Insert data and solve the following queries:

PROPERTIES(Pno, Type, Sq_Ft_Area, Rent, Address, Status, Owner No)
OWNERS (OwnerNo, OwnerName, Phno)

1. Display all 1 BHK apartments in Kothrud which are not rented
2. Display all properties owned by “Gopal”
3. Write a query to display the smallest property of each owner
4. Display all properties in Kothrud in Descending order of rent


----



CREATE TABLE OWNERS (
    OwnerNo VARCHAR(10) PRIMARY KEY,
    OwnerName VARCHAR(50) NOT NULL,
    Phno VARCHAR(15) UNIQUE
);

CREATE TABLE PROPERTIES (
    Pno VARCHAR(10) PRIMARY KEY,
    Type VARCHAR(20),
    Sq_Ft_Area INT CHECK (Sq_Ft_Area > 0),
    Rent NUMERIC(10, 2) CHECK (Rent > 0),
    Address VARCHAR(100),
    Status VARCHAR(20) CHECK (Status IN ('Rented', 'Available', 'Maintenance')),
    OwnerNo VARCHAR(10),
    FOREIGN KEY (OwnerNo) REFERENCES OWNERS(OwnerNo)
);




SELECT *
FROM PROPERTIES
WHERE Type = '1 BHK' AND Address LIKE '%Kothrud%' AND Status != 'Rented';






SELECT T1.*
FROM PROPERTIES T1
JOIN OWNERS T2 ON T1.OwnerNo = T2.OwnerNo
WHERE T2.OwnerName = 'Gopal';




-- Using a Window Function (If supported, e.g., PostgreSQL, SQL Server, Oracle)
/*
SELECT Pno, Type, Sq_Ft_Area, OwnerNo
FROM (
    SELECT
        Pno, Type, Sq_Ft_Area, OwnerNo,
        RANK() OVER (PARTITION BY OwnerNo ORDER BY Sq_Ft_Area ASC) as rnk
    FROM PROPERTIES
) AS RankedProperties
WHERE rnk = 1;
*/

-- Using Subquery (More standard SQL)
SELECT T1.Pno, T1.Type, T1.Sq_Ft_Area, T1.OwnerNo
FROM PROPERTIES T1
INNER JOIN (
    SELECT OwnerNo, MIN(Sq_Ft_Area) AS MinArea
    FROM PROPERTIES
    GROUP BY OwnerNo
) AS T2
ON T1.OwnerNo = T2.OwnerNo AND T1.Sq_Ft_Area = T2.MinArea;





SELECT *
FROM PROPERTIES
WHERE Address LIKE '%Kothrud%'
ORDER BY Rent DESC;